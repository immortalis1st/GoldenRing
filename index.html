<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Золотое кольцо России - Рабочий маршрут</title>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --dark: #333;
            --religious: #2e7d32;
            --museum: #ef6c00;
            --nature: #1565c0;
            --food: #d84315;
            --history: #00838f;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--religious));
        }
        
        h1 {
            font-size: 2.6rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #555;
            max-width: 800px;
            margin: 0 auto 20px;
            line-height: 1.5;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-radius: 12px;
            min-width: 160px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #666;
        }
        
        .day-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .day-card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 18px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.07);
            transition: all 0.35s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .day-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }
        
        .day-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.1);
        }
        
        .day-number {
            background: var(--primary);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .day-title {
            font-size: 1.6rem;
            color: var(--secondary);
            font-weight: 600;
        }
        
        .day-icon {
            font-size: 2rem;
            margin-left: auto;
            opacity: 0.9;
        }
        
        .locations {
            flex-grow: 1;
        }
        
        .location {
            margin-bottom: 22px;
            padding-bottom: 22px;
            border-bottom: 1px dashed rgba(0,0,0,0.08);
        }
        
        .location:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .location-header {
            margin-bottom: 8px;
        }
        
        .location-name {
            font-size: 1.25rem;
            color: var(--secondary);
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .category {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.82em;
            margin: 0 4px 6px 0;
            font-weight: 500;
        }
        
        .religious { background: rgba(232, 245, 233, 0.7); color: var(--religious); }
        .museum { background: rgba(255, 243, 224, 0.7); color: var(--museum); }
        .nature { background: rgba(227, 242, 253, 0.7); color: var(--nature); }
        .food { background: rgba(251, 233, 231, 0.7); color: var(--food); }
        .history { background: rgba(224, 247, 250, 0.7); color: var(--history); }
        
        .address {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #555;
            margin: 8px 0;
            font-size: 0.92rem;
        }
        
        .desc {
            color: #444;
            line-height: 1.6;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .route-btn, .photo-btn {
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.25s;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            flex: 1 1 45%;
            min-width: 120px;
            justify-content: center;
            text-align: center;
        }
        
        .route-btn {
            background: var(--primary);
            box-shadow: 0 3px 12px rgba(52, 152, 219, 0.25);
        }
        
        .route-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.35);
        }
        
        .photo-btn {
            background: var(--accent);
            box-shadow: 0 3px 12px rgba(231, 76, 60, 0.25);
        }
        
        .photo-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.35);
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: #666;
            font-size: 0.88rem;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
        }
        
        #loader {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            font-weight: 500;
            z-index: 1000;
        }
        
        .btn-icon {
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.1rem;
            }
            
            .subtitle {
                font-size: 1.05rem;
            }
            
            .day-cards {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .day-card {
                padding: 20px;
            }
            
            .stat-card {
                min-width: 130px;
                padding: 10px 15px;
            }
            
            .stat-value {
                font-size: 1.7rem;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .route-btn, .photo-btn {
                flex: 1 1 100%;
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .stat-card {
                min-width: 120px;
                padding: 8px 12px;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .day-header {
                flex-wrap: wrap;
            }
            
            .day-title {
                font-size: 1.4rem;
            }
            
            .location-name {
                font-size: 1.15rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>⛪🚗 Золотое кольцо России</h1>
            <p class="subtitle">Полностью рабочий маршрут с корректным открытием Яндекс.Карт</p>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value">8</div>
                    <div class="stat-label">городов</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">56</div>
                    <div class="stat-label">достопримечательностей</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">1000+</div>
                    <div class="stat-label">лет истории</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">∞</div>
                    <div class="stat-label">впечатлений</div>
                </div>
            </div>
        </header>
        
        <div class="day-cards" id="route-container"></div>
        
        <footer>
            <p>©Amadeus8bit | 2025 Маршрут по Золотому кольцу России | Для наилучшего опыта используйте Яндекс.Браузер с установленным приложением Яндекс.Карт</p>
        </footer>
        
        <div id="loader">Построение маршрута <i class="fas fa-spinner fa-spin"></i></div>
    </div>

    <script>
        const routeData = [
            {
                day: 1,
                city: "Ярославль",
                icon: "🏛️",
                locations: [
                    { 
                        name: "Спасо-Преображенский монастырь", 
                        address: "Богоявленская пл., 25",
                        category: "religious",
                        desc: "Исторический центр города, где было найдено «Слово о полку Игореве». Обязательно поднимитесь на колокольню для панорамного вида."
                    },
                    { 
                        name: "Церковь Ильи Пророка", 
                        address: "Советская пл., 7",
                        category: "religious",
                        desc: "Шедевр ярославской школы зодчества с уникальными фресками XVII века. Летом открыта для посещения."
                    },
                    { 
                        name: "Волжская набережная и Стрелка", 
                        address: "Волжская набережная",
                        category: "nature",
                        desc: "Живописные виды на место слияния Волги и Которосли. Идеально для вечерних прогулок и фотосессий."
                    },
                    { 
                        name: "Музей «Музыка и время»", 
                        address: "Волжская набережная, 33А",
                        category: "museum",
                        desc: "Частная коллекция старинных часов, колокольчиков и музыкальных инструментов. Можно услышать звучание некоторых экспонатов."
                    },
                    { 
                        name: "Толгский монастырь", 
                        address: "пос. Толга, 1",
                        category: "religious",
                        desc: "Действующий женский монастырь с чудотворной иконой XIV века. Особенно красив в мае, когда цветет сирень."
                    },
                    { 
                        name: "Парк «Тысячелетия Ярославля»", 
                        address: "ул. Подзеленье",
                        category: "nature",
                        desc: "Современный парк с арт-объектами и панорамным видом на реку. Отличное место для пикника."
                    },
                    { 
                        name: "Кафе «Иоанн Васильевич»", 
                        address: "Революционный пр., 4",
                        category: "food",
                        desc: "Традиционная русская кухня в историческом интерьере. Попробуйте их медовик и сбитень."
                    }
                ]
            },
            {
                day: 2,
                city: "Кострома",
                icon: "🦌",
                locations: [
                    { 
                        name: "Ипатьевский монастырь", 
                        address: "ул. Просвещения, 1",
                        category: "religious",
                        desc: "Место призвания на царство Михаила Романова в 1613 году. Обязательно посетите Троицкий собор с фресками Гурия Никитина."
                    },
                    { 
                        name: "Богоявленско-Анастасиин монастырь", 
                        address: "ул. Симановского, 26",
                        category: "religious",
                        desc: "Хранит чудотворную Феодоровскую икону Божией Матери. Главный собор монастыря - самый большой в Костроме."
                    },
                    { 
                        name: "Лосиная ферма «Сумароково»", 
                        address: "д. Сумароково",
                        category: "nature",
                        desc: "Единственная в мире ферма, где можно покормить лосей. Лучшее время для посещения - утро."
                    },
                    { 
                        name: "Музей деревянного зодчества", 
                        address: "ул. Просвещения, 1Б",
                        category: "museum",
                        desc: "Избы, церкви и ветряные мельницы XVII-XIX веков. Летом проходят фольклорные фестивали."
                    },
                    { 
                        name: "Торговые ряды", 
                        address: "ул. Советская, 2",
                        category: "history",
                        desc: "Гигантский торговый комплекс XIX века. Не пропустите Сырную биржу с дегустацией костромских сыров."
                    },
                    { 
                        name: "Беседка Островского", 
                        address: "набережная р. Волги",
                        category: "nature",
                        desc: "Классический вид на Волгу, вдохновлявший художников. Особенно красиво на закате."
                    },
                    { 
                        name: "Церковь Воскресения на Дебре", 
                        address: "ул. Нижняя Дебря, 37",
                        category: "religious",
                        desc: "Единственный сохранившийся посадский храм XVII века. Обратите внимание на резные ворота."
                    }
                ]
            },
            {
                day: 3,
                city: "Иваново",
                icon: "👗",
                locations: [
                    { 
                        name: "Введенский монастырь", 
                        address: "ул. Смирнова, 76",
                        category: "religious",
                        desc: "Действующий женский монастырь с необычной архитектурой в стиле модерн. Построен в начале XX века."
                    },
                    { 
                        name: "Музей ивановского ситца", 
                        address: "ул. Батурина, 11/42",
                        category: "museum",
                        desc: "История текстильной промышленности и уникальные образцы тканей. Расположен в особняке Д.Г. Бурылина."
                    },
                    { 
                        name: "Преображенский кафедральный собор", 
                        address: "ул. Колотилова, 44",
                        category: "religious",
                        desc: "Главный храм города в неовизантийском стиле. Построен в конце XIX века на средства фабрикантов."
                    },
                    { 
                        name: "Щудровская палатка", 
                        address: "ул. 10 Августа, 36",
                        category: "history",
                        desc: "Старейшее каменное здание города (XVII век). Изначально использовалось для сбора податей."
                    },
                    { 
                        name: "Музей промышленности и искусства", 
                        address: "ул. Батурина, 6/40",
                        category: "museum",
                        desc: "Коллекция египетских мумий, оружия и фарфора. Здание построено в стиле итальянского палаццо."
                    },
                    { 
                        name: "Парк им. Степанова", 
                        address: "ул. Смольная",
                        category: "nature",
                        desc: "Озеро с лебедями и зона для прогулок. Летом работает фонтан и летние кафе."
                    },
                    { 
                        name: "Кафе «Фабрика»", 
                        address: "ул. Красной Армии, 1",
                        category: "food",
                        desc: "Интерьер в стиле текстильной фабрики. Попробуйте фирменный ивановский борщ."
                    }
                ]
            },
            {
                day: 4,
                city: "Суздаль",
                icon: "🏰",
                locations: [
                    { 
                        name: "Суздальский Кремль", 
                        address: "ул. Кремлёвская, 27",
                        category: "history",
                        desc: "Древнейшая часть города с Рождественским собором XIII века. Обязательно посмотрите Златые врата."
                    },
                    { 
                        name: "Покровский монастырь", 
                        address: "ул. Покровская, 76",
                        category: "religious",
                        desc: "Место заточения знатных женщин, включая жен Ивана Грозного. Посетите Покровский собор XVI века."
                    },
                    { 
                        name: "Спасо-Евфимиев монастырь", 
                        address: "ул. Ленина, 148",
                        category: "religious",
                        desc: "Монастырь-крепость с фресками Гурия Никитина. Каждый час проходит концерт колокольных звонов."
                    },
                    { 
                        name: "Музей деревянного зодчества", 
                        address: "ул. Пушкарская, 27Б",
                        category: "museum",
                        desc: "Под открытым небом: избы, церкви, ветряные мельницы. Летом проходят мастер-классы ремесел."
                    },
                    { 
                        name: "Ризоположенский монастырь", 
                        address: "ул. Ленина, 79",
                        category: "religious",
                        desc: "Один из древнейших монастырей Руси (основан в 1207 г.). Поднимитесь на Преподобенскую колокольню для вида на город."
                    },
                    { 
                        name: "Дегустация медовухи", 
                        address: "Торговая площадь",
                        category: "food",
                        desc: "В древних погребах с десятками сортов традиционного напитка. Обязательно попробуйте с мятой и хреном."
                    },
                    { 
                        name: "Смотровая площадка у реки Каменка", 
                        address: "ул. Коровники",
                        category: "nature",
                        desc: "Панорамные виды на луга и купола церквей. Лучшее место для фотографий на закате."
                    }
                ]
            },
            {
                day: 5,
                city: "Владимир",
                icon: "🚪",
                locations: [
                    { 
                        name: "Успенский собор", 
                        address: "ул. Большая Московская, 56",
                        category: "religious",
                        desc: "Объект ЮНЕСКО с фресками Андрея Рублёва. Главный храм Северо-Восточной Руси XII века."
                    },
                    { 
                        name: "Дмитриевский собор", 
                        address: "ул. Большая Московская, 60",
                        category: "religious",
                        desc: "Шедевр белокаменной резьбы XII века. На фасадах более 600 рельефов с изображениями святых и животных."
                    },
                    { 
                        name: "Золотые ворота", 
                        address: "ул. Большая Московская, 1",
                        category: "history",
                        desc: "Уникальное оборонительное сооружение XII века. Внутри находится военно-историческая экспозиция."
                    },
                    { 
                        name: "Музей пряника", 
                        address: "ул. Большая Московская, 40",
                        category: "museum",
                        desc: "Мастер-классы по росписи и дегустация традиционных пряников. Попробуйте владимирскую вишню в шоколаде."
                    },
                    { 
                        name: "Княгинин монастырь", 
                        address: "ул. Княгининская, 37",
                        category: "religious",
                        desc: "Основан в 1200 году женой князя Всеволода Большое Гнездо. Сохранились фрески XVII века."
                    },
                    { 
                        name: "Патриарший сад", 
                        address: "ул. Козлов Вал, 5",
                        category: "nature",
                        desc: "Живописный ботанический сад с редкими растениями. Особенно красив в мае во время цветения сирени."
                    },
                    { 
                        name: "Старый Владимир", 
                        address: "ул. Козлов Вал, 14",
                        category: "museum",
                        desc: "История города в здании водонапорной башни XIX века. На верхнем этаже - смотровая площадка."
                    }
                ]
            },
            {
                day: 6,
                city: "Переславль-Залесский",
                icon: "⛵",
                locations: [
                    { 
                        name: "Никитский монастырь", 
                        address: "ул. Запрудная, 20",
                        category: "religious",
                        desc: "Древнейший монастырь Северо-Восточной Руси (основан в 1010 г.). Мощные стены выдержали польскую осаду."
                    },
                    { 
                        name: "Спасо-Преображенский собор", 
                        address: "Красная пл., 1",
                        category: "religious",
                        desc: "Один из древнейших храмов России (1152 г.). Здесь крестили Александра Невского."
                    },
                    { 
                        name: "Музей «Ботик Петра I»", 
                        address: "с. Веськово, ул. Петра I, 77",
                        category: "museum",
                        desc: "Место рождения русского флота - сохранился бот «Фортуна». В музее - экспозиция о создании потешной флотилии."
                    },
                    { 
                        name: "Плещеево озеро", 
                        address: "национальный парк «Плещеево озеро»",
                        category: "nature",
                        desc: "Легендарное озеро, где Петр I создавал свою «потешную флотилию». Летом можно покататься на лодках."
                    },
                    { 
                        name: "Феодоровский монастырь", 
                        address: "ул. Московская, 85",
                        category: "religious",
                        desc: "Основан в память о битве 1304 года. Главная святыня - Феодоровская икона Божией Матери."
                    },
                    { 
                        name: "Синий камень", 
                        address: "Александрова гора",
                        category: "history",
                        desc: "Древний языческий объект на берегу Плещеева озера. Весит 12 тонн и меняет цвет после дождя."
                    },
                    { 
                        name: "Музей утюга", 
                        address: "ул. Советская, 11",
                        category: "museum",
                        desc: "Уникальная коллекция из 200 утюгов разных эпох. Самый старый экспонат датирован XVII веком."
                    }
                ]
            },
            {
                day: 7,
                city: "Сергиев Посад",
                icon: "🕍",
                locations: [
                    { 
                        name: "Троице-Сергиева Лавра", 
                        address: "Свято-Троицкая Сергиева Лавра",
                        category: "religious",
                        desc: "Главный духовный центр России, объект ЮНЕСКО. Обязательно посетите Троицкий и Успенский соборы."
                    },
                    { 
                        name: "Черниговский скит", 
                        address: "ул. Гефсиманские пруды, 1",
                        category: "religious",
                        desc: "Пещерный комплекс с подземными храмами. Особенно красиво зимой, когда пещеры украшены ледяными узорами."
                    },
                    { 
                        name: "Музей игрушки", 
                        address: "пр. Красной Армии, 123",
                        category: "museum",
                        desc: "Коллекция игрушек царской семьи и советского детства. Более 30,000 экспонатов."
                    },
                    { 
                        name: "Покровский монастырь (Хотьково)", 
                        address: "г. Хотьково, ул. Кооперативная, 2",
                        category: "religious",
                        desc: "Древнейшая обитель, где покоятся родители Сергия Радонежского. Красивый парк с яблоневым садом."
                    },
                    { 
                        name: "Конный двор", 
                        address: "ул. 1-ой Ударной Армии, 2",
                        category: "history",
                        desc: "Музей народного быта и катание на лошадях. Попробуйте свежеиспеченный хлеб из русской печи."
                    },
                    { 
                        name: "Водопад Гремячий ключ", 
                        address: "дер. Взгляднево",
                        category: "nature",
                        desc: "Святой источник с водопадом высотой 25 метров. Вода считается целебной, температура круглый год +6°C."
                    },
                    { 
                        name: "Парк «Скитские пруды»", 
                        address: "пр. Красной Армии",
                        category: "nature",
                        desc: "Живописные пруды с лебедями и мостиками. Идеальное место для спокойной прогулки."
                    }
                ]
            },
            {
                day: 8,
                city: "Ростов Великий",
                icon: "🔔",
                locations: [
                    { 
                        name: "Ростовский Кремль", 
                        address: "ул. Кремль, 1",
                        category: "history",
                        desc: "Архитектурный шедевр XVII века. Обязательно посетите Белую палату и музей финифти."
                    },
                    { 
                        name: "Спасо-Яковлевский монастырь", 
                        address: "ул. Энгельса, 44",
                        category: "religious",
                        desc: "Жемчужина монастырского зодчества на берегу озера Неро. Особенно красив Димитриевский храм в стиле классицизма."
                    },
                    { 
                        name: "Авраамиев монастырь", 
                        address: "ул. Желябовская, 32",
                        category: "religious",
                        desc: "Древнейший монастырь Северо-Восточной Руси (основан в XI веке). По преданию, основан на месте капища Велеса."
                    },
                    { 
                        name: "Музей финифти", 
                        address: "ул. Карла Маркса, 3",
                        category: "museum",
                        desc: "Искусство ростовской эмали с мастер-классами. Можно купить уникальные сувениры."
                    },
                    { 
                        name: "Богоявленский Авраамиев монастырь", 
                        address: "ул. Желябовская, 32",
                        category: "religious",
                        desc: "Основан в XI веке на месте разрушения языческого идола Велеса. Сохранились фрески XVII века."
                    },
                    { 
                        name: "Озеро Неро", 
                        address: "набережная озера Неро",
                        category: "nature",
                        desc: "Прогулки на катере с панорамными видами на древние храмы. Возраст озера - около 500 тысяч лет."
                    },
                    { 
                        name: "Музей лука", 
                        address: "ул. Достоевского, 39",
                        category: "museum",
                        desc: "История знаменитого ростовского луководства. Дегустация разных сортов лука и луковых пирогов."
                    }
                ]
            }
        ];

        const categoryNames = {
            "religious": "Храм/Монастырь",
            "museum": "Музей",
            "nature": "Природа",
            "food": "Гастрономия",
            "history": "История"
        };

        const domCache = {
            container: null,
            loader: null
        };

        document.addEventListener('DOMContentLoaded', () => {
            domCache.container = document.getElementById('route-container');
            domCache.loader = document.getElementById('loader');
            
            buildRoute();
            setupEventListeners();
        });

        function buildRoute() {
            let html = '';
            
            routeData.forEach(day => {
                html += `
                    <div class="day-card">
                        <div class="day-header">
                            <div class="day-number">${day.day}</div>
                            <div class="day-title">${day.city}</div>
                            <div class="day-icon">${day.icon}</div>
                        </div>
                        <div class="locations">
                `;
                
                day.locations.forEach(location => {
                    const safeAddress = escapeHtml(location.address);
                    const safeName = escapeHtml(location.name);
                    const safeCity = escapeHtml(day.city);
                    
                    html += `
                        <div class="location">
                            <div class="location-header">
                                <h3 class="location-name">${location.name}</h3>
                            </div>
                            <div class="categories">
                                <span class="category ${location.category}">${categoryNames[location.category]}</span>
                            </div>
                            <div class="address">
                                <i class="fas fa-map-marker-alt"></i> ${location.address}
                            </div>
                            <p class="desc">${location.desc}</p>
                            <div class="buttons">
                                <button class="route-btn" data-address="${safeAddress}">
                                    <i class="fas fa-route btn-icon"></i> Маршрут
                                </button>
                                <button class="photo-btn" data-name="${safeName}" data-city="${safeCity}">
                                    <i class="fas fa-camera btn-icon"></i> Фото
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            domCache.container.innerHTML = html;
        }

        function setupEventListeners() {
            domCache.container.addEventListener('click', (e) => {
                const target = e.target;
                
                if (target.closest('.route-btn')) {
                    const btn = target.closest('.route-btn');
                    const address = btn.dataset.address;
                    getRoute(address);
                }
                
                if (target.closest('.photo-btn')) {
                    const btn = target.closest('.photo-btn');
                    const name = btn.dataset.name;
                    const city = btn.dataset.city;
                    showPhotos(name, city);
                }
            });
        }

        // ФИКСИРОВАННАЯ ФУНКЦИЯ ДЛЯ ANDROID
        async function getRoute(address) {
            showLoader();
            
            try {
                if (!navigator.geolocation) {
                    throw new Error('Геолокация не поддерживается вашим браузером');
                }

                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 8000,
                        maximumAge: 0
                    });
                });

                const coords = position.coords;
                const startCoords = `${coords.latitude},${coords.longitude}`;
                const endAddress = encodeURIComponent(address);
                
                // Основной URL для построения маршрута
                const routeUrl = `https://yandex.ru/maps/?rtext=${startCoords}~${endAddress}&rtt=auto`;
                
                const isAndroid = /Android/i.test(navigator.userAgent);
                const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
                const isYandexBrowser = navigator.userAgent.includes('YaBrowser');
                const isChrome = /Chrome/i.test(navigator.userAgent);

                // 1. Попробуем открыть через универсальную ссылку
                window.location.href = routeUrl;
                
                // 2. Фолбек для прямого открытия приложения
                setTimeout(() => {
                    if (!document.hidden) {
                        // Для Android
                        if (isAndroid) {
                            const androidDeepLink = `yandexmaps://build/route/?rtext=${startCoords}~${endAddress}&rtt=auto`;
                            
                            if (isYandexBrowser) {
                                // Для Яндекс.Браузера
                                const intentUrl = `intent://yandex.ru/maps/?rtext=${startCoords}~${endAddress}#Intent;scheme=https;package=ru.yandex.yandexmaps;end`;
                                window.location.href = intentUrl;
                            } else if (isChrome) {
                                // Для Chrome на Android
                                const iframe = document.createElement('iframe');
                                iframe.style.display = 'none';
                                iframe.src = androidDeepLink;
                                document.body.appendChild(iframe);
                                setTimeout(() => {
                                    document.body.removeChild(iframe);
                                }, 300);
                            } else {
                                // Для других браузеров на Android
                                window.location.href = androidDeepLink;
                            }
                        } 
                        // Для iOS
                        else if (isIOS) {
                            const iosDeepLink = `yandexmaps://maps.yandex.ru/?rtext=${startCoords}~${endAddress}&rtt=auto`;
                            window.location.href = iosDeepLink;
                        }
                        
                        // 3. Финальный фолбек на веб-версию
                        setTimeout(() => {
                            if (!document.hidden) {
                                window.open(routeUrl, '_blank');
                            }
                        }, 1000);
                    }
                }, 600);

            } catch (error) {
                handleGeolocationError(error);
            } finally {
                setTimeout(() => {
                    hideLoader();
                }, 1500);
            }
        }

        function showPhotos(name, city) {
            const query = `${name}, ${city}, Россия`;
            const url = `https://yandex.ru/images/search?text=${encodeURIComponent(query)}&itype=jpg`;
            window.open(url, '_blank');
        }

        function handleGeolocationError(error) {
            console.error('Ошибка геолокации:', error);
            let message = 'Ошибка при построении маршрута';
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = 'Разрешите доступ к геолокации в настройках браузера';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'Информация о местоположении недоступна';
                    break;
                case error.TIMEOUT:
                    message = 'Превышено время ожидания определения местоположения';
                    break;
            }
            
            alert(message);
        }

        function showLoader() {
            domCache.loader.style.display = 'block';
        }

        function hideLoader() {
            domCache.loader.style.display = 'none';
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
